<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Анонимное общение — StillyLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <style>
        .anon-wrapper {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .anon-card {
            background: var(--bg-card, #1a1c1f);
            color: #fff;
            padding: 20px;
            width: 300px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
            border: 1px solid #2a2c2f;
        }

        .anon-card:hover {
            transform: translateY(-5px);
            opacity: 0.9;
        }

        .anon-card h3 {
            margin-bottom: 10px;
            font-size: 20px;
            font-weight: bold;
        }

        .anon-card p {
            font-size: 15px;
            opacity: 0.8;
        }
    </style>
</head>
<body>

<header class="navbar">
    <div class="logo">StillyLink</div>

    <nav class="nav-links">
        <a href="/">Главная</a>
        <a href="/chats/">Чаты</a>
        <a href="/index.html#create-chat">Создать чат</a>
        <a href="/anonymous/">Анонимное общение</a>
        <a href="/login/" class="register-btn">Регистрация</a>
    </nav>

    <div class="user-avatar hidden" onclick="toggleUserMenu()">
        <span>U</span>
    </div>

    <div class="user-menu">
        <a href="/profile/">Профиль</a>
        <a href="/mychats/">Мои чаты</a>
        <a href="#" id="logoutBtn">Выйти</a>
    </div>

    <div class="nav-toggle" onclick="toggleMenu()">☰</div>
</header>

<div class="menu-overlay"></div>

<section class="section">
    <h2>Анонимное общение</h2>

    <div class="anon-wrapper">
        <div class="anon-card" onclick="location.href='/anonymous/private/'">
            <h3>Анонимный чат один на один</h3>
            <p>Общение между двумя пользователями без регистрации и без ввода ника.</p>
        </div>

        <div class="anon-card" onclick="location.href='/anonymous/group/'">
            <h3>Анонимная группа</h3>
            <p>Войдите в общий чат с ником и общайтесь с неограниченным количеством людей.</p>
        </div>
    </div>
</section>

<footer class="footer">
    <p>© 2025 StillyLink. Все права защищены.</p>
</footer>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { 
    getAuth,
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

// --- CONFIG ---
const firebaseConfig = {
    apiKey: "AIzaSyBWlR4QWdnbqXLKKaftEAzhXneTmV9xXX0",
    authDomain: "stillylink-f1d0f.firebaseapp.com",
    projectId: "stillylink-f1d0f",
    storageBucket: "stillylink-f1d0f.appspot.com",
    messagingSenderId: "772070114710",
    appId: "1:772070114710:web:939bce83e4d3be14bdc9b7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// UI элементы
const regBtn = document.querySelector(".register-btn");
const avatar = document.querySelector(".user-avatar");
const avatarLetter = document.querySelector(".user-avatar span");
const userMenu = document.querySelector(".user-menu");
const logoutBtn = document.getElementById("logoutBtn");

// === Локальное восстановление состояния ===
const savedLogin = localStorage.getItem("isLoggedIn");
const savedLetter = localStorage.getItem("avatarLetter");

if (savedLogin === "true" && savedLetter) {
    regBtn.classList.add("hidden");
    avatar.classList.remove("hidden");
    avatarLetter.textContent = savedLetter;
}

// --- Авторизация ---
onAuthStateChanged(auth, user => {
    if (user) {
        const letter = user.email?.charAt(0).toUpperCase() || "U";

        regBtn.classList.add("hidden");
        avatar.classList.remove("hidden");
        avatarLetter.textContent = letter;

        localStorage.setItem("isLoggedIn", "true");
        localStorage.setItem("avatarLetter", letter);

    } else {
        regBtn.classList.remove("hidden");
        avatar.classList.add("hidden");

        localStorage.removeItem("isLoggedIn");
        localStorage.removeItem("avatarLetter");
    }
});

// --- Выход ---
logoutBtn.onclick = (e) => {
    e.preventDefault();

    localStorage.removeItem("isLoggedIn");
    localStorage.removeItem("avatarLetter");

    signOut(auth).then(() => window.location.reload());
};
</script>

<!-- ============== МЕНЮ НАВИГАЦИИ ============== -->
<script>
function toggleMenu() {
    const menu = document.querySelector(".nav-links");
    menu.classList.toggle("open");
}

document.addEventListener("click", function(e) {
    const menu = document.querySelector(".nav-links");
    const toggle = document.querySelector(".nav-toggle");

    if (!menu.classList.contains("open")) return;
    if (menu.contains(e.target) || toggle.contains(e.target)) return;

    menu.classList.remove("open");
});
</script>

<!-- ============== МЕНЮ АВАТАРКИ ============== -->
<script>
function toggleUserMenu() {
    document.querySelector(".user-menu").classList.toggle("open");
}

document.addEventListener("click", function(e) {
    const menu = document.querySelector(".user-menu");
    const avatar = document.querySelector(".user-avatar");

    if (!menu.classList.contains("open")) return;
    if (menu.contains(e.target) || avatar.contains(e.target)) return;

    menu.classList.remove("open");
});
</script>

</body>
</html>
