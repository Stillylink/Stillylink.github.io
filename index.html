<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>StillyLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="navbar">
    <div class="logo">StillyLink</div>

    <nav class="nav-links">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/chats/">–ß–∞—Ç—ã</a>
        <a href="../index.html#create-chat">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</a>

        <!-- –î–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É -->
        <a class="auth-btn" href="/login/">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>

        <!-- –ê–≤–∞—Ç–∞—Ä (—Å–∫—Ä—ã—Ç –¥–æ –≤—Ö–æ–¥–∞) -->
        <div class="user-avatar hidden" id="userAvatar"></div>
    </nav>

    <!-- –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-menu" id="userMenu">
        <a href="/profile/">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="/my-chats/">–ú–æ–∏ —á–∞—Ç—ã</a>
        <a id="logoutBtn">–í—ã–π—Ç–∏</a>
    </div>

    <!-- –ë—É—Ä–≥–µ—Ä -->
    <div class="nav-toggle" onclick="toggleMenu()">‚ò∞</div>
</header>

<div class="menu-overlay"></div>

<section class="hero">
    <h1>StillyLink</h1>
    <p>–û–±—â–∞–π—Å—è —Å–≤–æ–±–æ–¥–Ω–æ. –ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ª–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å.</p>

    <a href="#create-chat" class="hero-btn">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</a>
</section>

<section id="create-chat" class="section">
    <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç</h2>

    <div class="card">
        <input class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞">
        <input class="input" type="text" placeholder="–í–∞—à –Ω–∏–∫">
        <button class="btn">–°–æ–∑–¥–∞—Ç—å</button>
    </div>
</section>

<section class="section">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

    <div class="card">
        <input class="input" type="text" placeholder="–õ–æ–≥–∏–Ω">
        <input class="input" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
</section>

<footer class="footer">
    <p>¬© 2025 StillyLink. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp }
        from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBWlR4QWdnbqXLKKaftEAzhXneTmV9xXX0",
        authDomain: "stillylink-f1d0f.firebaseapp.com",
        projectId: "stillylink-f1d0f",
        storageBucket: "stillylink-f1d0f.firebasestorage.app",
        messagingSenderId: "772070114710",
        appId: "1:772070114710:web:939bce83e4d3be14bdc9b7",
        measurementId: "G-N8FHLR5GFQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const authBtn = document.querySelector(".auth-btn");
    const avatar = document.getElementById("userAvatar");
    const userMenu = document.getElementById("userMenu");

    /* üî• –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ */
    onAuthStateChanged(auth, user => {
        if (user) {
            const name = user.email ? user.email[0].toUpperCase() : "U";

            avatar.textContent = name;
            avatar.classList.remove("hidden");
            authBtn.classList.add("hidden");
        } else {
            avatar.classList.add("hidden");
            authBtn.classList.remove("hidden");
        }
    });

    /* üî• –í—ã—Ö–æ–¥ */
    document.getElementById("logoutBtn").onclick = () => {
        signOut(auth);
        window.location.reload();
    };

    /* –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞ */
    const createBtn = document.querySelector("#create-chat .btn");
    const nameInput = document.querySelectorAll("#create-chat .input")[0];
    const userInput = document.querySelectorAll("#create-chat .input")[1];

    createBtn.onclick = async () => {
        const roomName = nameInput.value.trim();
        const userName = userInput.value.trim();

        if (!roomName || !userName) {
            alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
            return;
        }

        const docRef = await addDoc(collection(db, "rooms"), {
            name: roomName,
            createdAt: serverTimestamp()
        });

        window.location.href = `chat/?room=${docRef.id}&user=${encodeURIComponent(userName)}`;
    };

    /* ‚¨á –º–µ–Ω—é –∞–≤–∞—Ç–∞—Ä–∞ */
    avatar.onclick = () => {
        userMenu.classList.toggle("open");
    };

    document.addEventListener("click", e => {
        if (!avatar.contains(e.target) && !userMenu.contains(e.target)) {
            userMenu.classList.remove("open");
        }
    });
</script>

<script>
function toggleMenu() {
    const menu = document.querySelector(".nav-links");
    const overlay = document.querySelector(".menu-overlay");

    menu.classList.toggle("open");
    overlay.classList.toggle("show");
}

document.addEventListener("click", function(e) {
    const menu = document.querySelector(".nav-links");
    const toggle = document.querySelector(".nav-toggle");
    const overlay = document.querySelector(".menu-overlay");

    if (!menu.classList.contains("open")) return;
    if (menu.contains(e.target) || toggle.contains(e.target)) return;

    menu.classList.remove("open");
    overlay.classList.remove("show");
});
</script>

</body>
</html>
